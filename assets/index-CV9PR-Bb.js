var Bt=Object.defineProperty;var ut=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var mt=(n,t,e)=>t in n?Bt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,A=(n,t)=>{for(var e in t||(t={}))wt.call(t,e)&&mt(n,e,t[e]);if(ut)for(var e of ut(t))xt.call(t,e)&&mt(n,e,t[e]);return n};var $=(n,t)=>{var e={};for(var s in n)wt.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&ut)for(var s of ut(n))t.indexOf(s)<0&&xt.call(n,s)&&(e[s]=n[s]);return e};var L=(n,t,e)=>(mt(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();function Nt(n){return n.filter((t,e)=>n.lastIndexOf(t)===e)}class _t{constructor(t){L(this,"node");L(this,"props");L(this,"children",[]);L(this,"parent",null);this.props=t,this.node=this.createNode(t)}createNode(_){var l=_,{tag:t,style:e,classList:s,textContent:o,children:a}=l,i=$(l,["tag","style","classList","textContent","children"]);this.props=A({tag:t,classList:s,textContent:o,children:a},i);let c=document.createElement(t!=null?t:"div");return c=Object.assign(c,i),s&&this.applyClassList(c,s),o&&(c.textContent=o),a&&(this.children=this.appendChildrenToNode(c,a)),e&&Object.entries(e).forEach(([d,f])=>{if(f){const g=String(f);c.style.setProperty(d,g)}}),this.children=Nt(this.children).filter(d=>this.isChild(d)),c}isChild(t){return t.parent===this}appendChildren(t){return Array.isArray(t)?t.forEach(e=>this.append(e)):this.append(t),this}append(t){const e=this.appendToNode(this.node,t);return e&&this.children.push(e),this.children=Nt(this.children).filter(s=>this.isChild(s)),this}addEventListener(t,e,s){return this.node.addEventListener(t,e,s),this}log(){return this}getNode(){return this.node}getChildren(){return this.children}addClass(t){return this.node.classList.add(t),this}toggleClass(t){this.node.classList.toggle(t)}removeClass(t){this.node.classList.remove(t)}destroy(){var t;(t=this.parent)==null||t.removeChildren(this),this.children.forEach(e=>e.destroy()),this.node.remove()}applyClassList(t,e){typeof e=="string"?t.classList.add(e):t.classList.add(...e)}appendChildrenToNode(t,e){const s=[];if(Array.isArray(e))e.forEach(o=>{const a=this.appendToNode(t,o);a&&s.push(a)});else{const o=this.appendToNode(t,e);o!==void 0&&s.push(o)}return s}appendToNode(t,e){var s;if(typeof e=="string"){t.append(document.createTextNode(e));return}return(s=e.parent)==null||s.removeChildren(e),e.parent=this,t.append(e.node),e}haveChildren(t){return this.children.some(e=>e.getNode().isEqualNode(t.getNode()))}haveChildrenNode(t){return Array.from(this.node.children).some(e=>e.isEqualNode(t))}isNode(t){return this.node.isEqualNode(t)}replaceWith(t){return this.parent&&(this.parent.children.filter(e=>!e.getNode().isEqualNode(t.getNode())),this.parent=t.parent),t.parent&&(t.parent.children.filter(e=>!e.getNode().isEqualNode(this.getNode())),t.parent=this.parent),[this.node,t.node]=[t.node,this.node],this.node.replaceWith(t.node),this}removeChildren(t){return t.getNode().remove(),this.children=this.children.filter(e=>!e.getNode().isEqualNode(t.getNode())),t.parent=null,this}remove(){this.getNode().remove()}componentDidMount(t){return new Promise(e=>{new MutationObserver((o,a)=>{this.node&&(e(this),a.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}).then(()=>t(this)).catch(e=>{}),this}}const r=n=>new _t(n),Ht=""+new URL("logo-img-C-RDXH51.png",import.meta.url).href;var at=(n=>(n.siteName="capyPuzzle",n.footerText="© 2024 capyPuzzle.",n.startPageAboutDescription="Наши пазлы – это необычный способ учить английский. Собирайте предложения, как пазлы. Каждый пазл – это новое слово, которое вы запомните. А чтобы вас еще больше вдохновляло, по мере сбора слов, открываются красочные картинки. Играйте и учитесь вместе с capyPuzzle! 🧩🔤",n.startPageAboutTitle="Сapy Puzzle: Игра для изучения английского через сбор пазлов",n.startPageAboutLInks="Ссылки:",n))(at||{});const y=(...n)=>{const t=[];return n.forEach(e=>{typeof e=="string"&&t.push(e),Array.isArray(e)&&t.push(...e)}),t},q=(...n)=>{const t=[];return n.forEach(e=>{Array.isArray(e)?t.concat(e):e!==void 0&&t.push(e)}),t},pt={"site-logo":"_site-logo_1onog_2","site-logo__img":"_site-logo__img_1onog_9","site-logo__text":"_site-logo__text_1onog_12"},Mt=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);const a=r({tag:"img",classList:pt["site-logo__img"],src:Ht,alt:`logo ${at.siteName}`}),i=r({tag:"span",classList:pt["site-logo__text"],textContent:at.siteName});return r(A({tag:"a",classList:y(pt["site-logo"],n),children:q(a,i,t)},e))},B=n=>{throw new Error(n)},Z=class Z{constructor(){L(this,"prefix","capyPuzzle");L(this,"version","1.0.1");L(this,"state");L(this,"stateProxy");this.state=this.createOrGetState(),this.stateProxy=this.createProxy()}static create(){return Z.instance&&B("Local storage provider already created"),Z.instance=new Z,Z.instance}static getIsInitialized(){return!!Z.instance}createOrGetState(){const t=localStorage.getItem(this.getStorageKey());return!this.state&&t&&(this.state=JSON.parse(t)),this.state||(this.state={session:{isAuth:!1,userId:null},users:{},saveData:{},totalUser:0},localStorage.setItem(this.getStorageKey(),JSON.stringify(this.state))),this.state}getStorageKey(){return`${this.prefix}@${this.version}:data`}createProxy(){const t=e=>new Proxy(e,{set:(s,o,a)=>{const i=s;return i[o]=a,localStorage.setItem(this.getStorageKey(),JSON.stringify(this.state)),!0},get:(s,o)=>typeof s[o]=="object"?t(s[o]):(this.createOrGetState(),s[o])});return t(this.state)}static getInstance(){return Z.instance}};L(Z,"instance");let ct=Z;const nt=()=>(ct.getIsInitialized()||B("Local storage provider not created"),{state:ct.getInstance().stateProxy,isInitialized:ct.getIsInitialized()}),Vt=()=>(ct.create(),nt()),Q=class Q{static create(){return Q.instance&&B("Auth Provider already created"),nt().isInitialized||B("For a AuthProvider work, initiate localStorageProvider first"),Q.instance=new Q,Q.instance}static getIsInitialized(){return!!Q.instance}getIsAuth(){return nt().state.session.isAuth}singUp(t,e,s){const{state:o}=nt(),a={success:!1,action:"signup",messages:[]};Object.keys(o.users).some(_=>{const l=o.users[_];return l&&l.surname===e&&l.name===t?(a.messages.push("User already exist"),!0):!1});const i=/^[A-Z][A-z-]*$/;if((!i.test(t)||!i.test(e)||t.length<3||e.length<4)&&a.messages.push("Incorrect format"),a.messages.length>0){s(a);return}o.totalUser+=1,o.users[o.totalUser]={name:t,surname:e,saveDataId:o.totalUser},o.saveData={},o.saveData[o.totalUser]={showPuzzle:!0,audioOn:!0,translateTextOn:!0},o.session.isAuth=!0,o.session.userId=o.totalUser,s({success:!0,action:"signup",messages:["All ok"]})}logout(t){const{session:e}=nt().state;e.isAuth=!1,e.userId=null,t({success:!0,action:"logout",messages:["All ok"]})}getUser(){const{state:t}=nt();if(this.getIsAuth()){const e=t.users[t.session.userId],s=t.saveData[e.saveDataId];return{user:e,savedData:s}}}login(t,e,s){const{state:o}=nt(),a=Object.keys(o.users).some(i=>{const _=o.users[i];return _&&_.surname===e&&_.name===t?(o.session.isAuth=!0,o.session.userId=i,!0):!1});s(a?{success:!0,action:"login",messages:["All ok"]}:{success:!1,action:"login",messages:["User not exist"]})}static getInstance(){return Q.instance}static getDefaultSessionObject(){return{isAuth:!1,userId:null}}};L(Q,"instance");let dt=Q;const Y=()=>{var t,e;dt.getInstance()||B("Auth Provider not created");const n=dt.getInstance();return{isAuth:n.getIsAuth(),singUp:n.singUp.bind(n),logout:n.logout.bind(n),login:n.login.bind(n),user:(t=n.getUser())==null?void 0:t.user,saveData:(e=n.getUser())==null?void 0:e.savedData,isInitialized:dt.getIsInitialized()}},Xt=()=>(dt.create(),Y()),Et={"auth-action":"_auth-action_1wm33_2"},Yt=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);const{isAuth:a,logout:i}=Y(),{route:_}=rt(),l=r({tag:"a",classList:Et["auth-action__link"],textContent:a?"Выйти":"Войти"}).addEventListener("click",()=>a?i(()=>_(S.startPage)):_(S.loginPage));return r(A({tag:"div",classList:y(Et["auth-action"],n),children:q(l,t)},e))},qt="_header_jaupp_2",Ft="_header__content_jaupp_8",Pt={header:qt,header__content:Ft},vt=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);const{route:a}=rt(),i=Mt({}).addEventListener("click",()=>a(S.startPage)),_=Yt({}),l=r({tag:"div",classList:Pt.header__content,children:[i,_]});return r(A({tag:"header",classList:y(Pt.header,n),children:q(l,t)},e))},Kt="_banner_uv7mz_2",Jt="_banner__image_uv7mz_8",It={banner:Kt,banner__image:Jt},Gt=o=>{var a=o,{classList:n,children:t,imgSrc:e}=a,s=$(a,["classList","children","imgSrc"]);const i=r({tag:"img",classList:It.banner__image,src:e,alt:"banner"});return r(A({tag:"div",classList:y(It.banner,n),children:q(i,t)},s))},Zt=""+new URL("banner-img-CwS2J0xk.png",import.meta.url).href,St={"logo-link":"_logo-link_ot1z4_2","logo-link__img":"_logo-link__img_ot1z4_9"},kt=a=>{var i=a,{classList:n,children:t,altText:e,imgSrc:s}=i,o=$(i,["classList","children","altText","imgSrc"]);const _=r({tag:"img",src:s,alt:e,classList:St["logo-link__img"]});return r(A({tag:"a",classList:y(St["logo-link"],n),children:q(_,t)},o))},Qt=""+new URL("rs-logo-D9C1k5Xz.png",import.meta.url).href,te=""+new URL("gh-logo-CWeeGzFL.png",import.meta.url).href,ee="_button_82d02_2",oe={button:ee},Tt=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);return r(A({tag:"button",classList:y(oe.button,n),children:t},e))},ne="_main_164zi_2",se="_main__content_164zi_5",ae="_actions_164zi_63",M={main:ne,main__content:se,"about-game":"_about-game_164zi_17","about-game__title":"_about-game__title_164zi_23","about-game__description":"_about-game__description_164zi_26","about-game__text":"_about-game__text_164zi_30","about-game__banner":"_about-game__banner_164zi_38","about-game__wrapper":"_about-game__wrapper_164zi_47",actions:ae,"actions__useful-links":"_actions__useful-links_164zi_67","actions__start-button-wrapper":"_actions__start-button-wrapper_164zi_73","actions__start-button":"_actions__start-button_164zi_73"},ie=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);var d,f;const{isAuth:a,user:i}=Y(),{route:_}=rt(),l=r({tag:"div",classList:M["about-game__wrapper"],children:[r({tag:"div",classList:M["about-game__text"],children:[r({tag:"h2",textContent:at.startPageAboutTitle,classList:M["about-game__title"]}),r({tag:"p",textContent:a?`С возвращением ${(d=i==null?void 0:i.name)!=null?d:"Иван"} ${(f=i==null?void 0:i.surname)!=null?f:"Иваныч"} быстрей жми на кнопку чтобы продолжить играть!`:at.startPageAboutDescription,classList:M["about-game__description"]}),r({tag:"div",classList:M.actions,children:[r({tag:"div",classList:M["actions__useful-links"],children:[r({tag:"span",textContent:at.startPageAboutLInks}),kt({classList:M.actions__link,imgSrc:te,altText:"@FYMG",title:"@FYMG",href:"https://github.com/FYMG"}),kt({classList:M.actions__link,imgSrc:Qt,altText:"RsSchool 2024",title:"RsSchool 2024",href:"https://rs.school/js/"})]}),r({tag:"div",classList:M["actions__start-button-wrapper"],children:[Tt({classList:M["actions__start-button"],textContent:a?"Продолжить":"Регистрация"}).addEventListener("click",()=>a?_(S.gamePage):_(S.loginPage,{reg:!0}))]})]})]}),Gt({classList:M["about-game__banner"],imgSrc:Zt})]}),c=r({tag:"section",classList:y(M.main__content,M["about-game"]),children:l});return r(A({tag:"main",classList:y(M.main,n),children:q(c,t)},e))},re="_footer_llri0_2",le="_footer__content_llri0_5",At={footer:re,footer__content:le},Lt=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);const a=r({tag:"div",classList:At.footer__content,children:[r({tag:"p",textContent:at.footerText})]});return r(A({tag:"footer",classList:y(At.footer,n),children:q(a,t)},e))},ce=()=>r({tag:"template",children:[vt({}),ie({}),Lt({})]}),de=""+new URL("login-page-img-D7zVMXhL.png",import.meta.url).href,_e=/^[A-z-]*$/;function gt(n,t){const e=[];return n?(n.length<t&&e.push(`мнимальная длина = ${t}`),n[0].toUpperCase()!==n[0]&&e.push("первая буква должна быть заглавной"),_e.test(n)||e.push('только латиница и "-"')):e.push("Поле не может быть пустым"),e.join(", ")}const ue="_main_25taf_2",ge="_main__content_25taf_5",T={main:ue,main__content:ge,"login-form":"_login-form_25taf_15","login-form__label":"_login-form__label_25taf_27","login-form__title":"_login-form__title_25taf_33","login-form__button":"_login-form__button_25taf_37","login-form__error":"_login-form__error_25taf_41","login-form__additions":"_login-form__additions_25taf_44","login-form__mode":"_login-form__mode_25taf_51","login-form__input":"_login-form__input_25taf_54","login-form__img":"_login-form__img_25taf_58"},he=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);var w;const{route:a,args:i}=rt(),{login:_,singUp:l}=Y(),c=(w=i.reg)!=null?w:!1,d=r({tag:"span",classList:T["login-form__error"]}),f=r({tag:"span",classList:T["login-form__error"]}),g=r({tag:"input",classList:T["login-form__input"],placeholder:"Введите имя",required:!0,type:"text"}),N=r({tag:"span",classList:T["login-form__error"]}),p=r({tag:"input",classList:T["login-form__input"],placeholder:"Введите фамилию",required:!0,type:"text"}),m=Tt({textContent:c?"Зарегистрироваться":"Войти",classList:T["login-form__button"],type:"submit",disabled:!0}).addEventListener("click",I=>{I.preventDefault();const R=g.getNode().value,j=p.getNode().value,C=[l,_][c?0:1];C==null||C(R,j,U=>{d.getNode().textContent=U.messages.join(", "),U.success&&a(S.gamePage)})}),u=r({tag:"form",classList:T["login-form"],children:[r({tag:"h2",textContent:c?"Регистрация":"Вход",classList:T["login-form__title"]}),r({tag:"label",classList:T["login-form__label"],children:[r({tag:"span",textContent:"Name",classList:T["login-form__label-text"]}),g,f]}),r({tag:"label",classList:T["login-form__label"],children:[r({tag:"span",textContent:"Surname",classList:T["login-form__label-text"]}),p,N]}),r({tag:"div",classList:T["login-form__additions"],children:[d,r({tag:"a",classList:T["login-form__mode"],textContent:c?"Вход":"Регистрация"}).addEventListener("click",()=>{a(S.loginPage,{reg:!c})})]}),m,r({tag:"img",classList:T["login-form__img"],src:de,alt:"login form img"})]}).addEventListener("input",I=>{var C,U,H,W;const R=(C=p.getNode().value)!=null?C:"",j=(U=g.getNode().value)!=null?U:"";(H=I.target)!=null&&H.isEqualNode(g.getNode())&&(f.getNode().textContent=gt(j,3)),(W=I.target)!=null&&W.isEqualNode(p.getNode())&&(N.getNode().textContent=gt(R,4)),m.getNode().disabled=!!(gt(j,3)||gt(R,4))}),b=r({tag:"section",classList:y(T.main__content),children:[u]});return r(A({tag:"main",classList:y(T.main,n),children:q(b,t)},e))},me=()=>r({tag:"template",children:[vt({}),he({}),Lt({})]}),pe=""+new URL("puzzle-texture-BUJDA_KF.jpg",import.meta.url).href;function fe(n,t){let e=0;n.forEach(s=>{s.onload=()=>{e+=1,e===n.length&&t()}})}const be="_board_1aoem_2",ve="_board__loader_1aoem_12",Le="_board__text_1aoem_19",ze="_board_loading_1aoem_28",ye="_board__standbyPuzzleList_1aoem_33",Ce="_board__img_1aoem_40",we="_board__img_carton_1aoem_45",xe="_board__row_1aoem_58",Ne="_board__row_current_1aoem_64",Ee="_board__row_hidden_1aoem_67",V={board:be,board__loader:ve,board__text:Le,board_loading:ze,board__standbyPuzzleList:ye,board__img:Ce,board__img_carton:we,"board__puzzle-wrapper":"_board__puzzle-wrapper_1aoem_51",board__row:xe,board__row_current:Ne,board__row_hidden:Ee},Pe="_puzzle_od1uu_2",Ie="_puzzle__img_od1uu_23",Se="_puzzle_fantom_od1uu_27",ke="_puzzle__text_od1uu_12",J={puzzle:Pe,"puzzle__text-wrapper":"_puzzle__text-wrapper_od1uu_12",puzzle__img:Ie,puzzle_fantom:Se,puzzle__text:ke,"puzzle_valid-good":"_puzzle_valid-good_od1uu_34","puzzle_valid-bad":"_puzzle_valid-bad_od1uu_38"},Ae=(n,t,e,s)=>{let o=0,a=0,i=!1;const _=l=>{var I,R,j,C,U,H,W,E,v;if(n.disabled)return;const c=n.getNode(),d=c.cloneNode(!0);d==null||d.classList.add((I=J.puzzle_fantom)!=null?I:"");const f=window.getComputedStyle(c);let g;const N=parseInt(f.getPropertyValue("--puzzle-x"),10),p=parseInt(f.getPropertyValue("--puzzle-y"),10);o=0,a=0,l instanceof TouchEvent&&(o=(j=(R=c.parentElement)==null?void 0:R.getBoundingClientRect().x)!=null?j:l.touches[0].pageX-N,a=(U=(C=c.parentElement)==null?void 0:C.getBoundingClientRect().y)!=null?U:l.touches[0].pageY-p),l instanceof MouseEvent&&(o=(W=(H=c.parentElement)==null?void 0:H.getBoundingClientRect().x)!=null?W:l.pageX-N,a=(v=(E=c.parentElement)==null?void 0:E.getBoundingClientRect().y)!=null?v:l.pageY-p);let m=o,u=a;const b=h=>{var F;let z=0,D=0,P=0,X=0;h instanceof TouchEvent&&(z=h.touches[0].pageX,D=h.touches[0].clientX,P=h.touches[0].pageY,X=h.touches[0].clientY),h instanceof MouseEvent&&(z=h.pageX,D=h.clientX,P=h.pageY,X=h.clientY),!(Math.abs(P-a)<10&&Math.abs(z-o)<10)&&(i=!0,g=document.elementFromPoint(D,X),c.style.setProperty("position","absolute"),c.style.setProperty("--puzzle-x",`${z-o}px`),c.style.setProperty("--puzzle-y",`${P-a}px`),c.style.setProperty("pointer-events","none"),c.style.setProperty("z-index","2"),!(Math.abs(m-z)<10&&Math.abs(u-P)<10||g!=null&&g.isEqualNode(d))&&(m=z,u=P,g&&(t.isNode(g)||e.isNode(g))?g.append(d):g&&!g.isEqualNode(c)&&g.classList.contains((F=J.puzzle)!=null?F:"")&&(t.haveChildrenNode(g)||e.haveChildrenNode(g))?Math.abs(g.getBoundingClientRect().left-z)<=g.clientWidth/2?g.before(d):g.after(d):d.remove()))},w=()=>{document.body.removeEventListener("mousemove",b),document.body.removeEventListener("mouseup",w),document.body.removeEventListener("touchmove",b),document.body.removeEventListener("touchend",w),i&&(t.haveChildrenNode(d)&&t.append(n),e.haveChildrenNode(d)&&e.append(n),d.replaceWith(c),d.remove(),c.style.setProperty("--puzzle-x","0px"),c.style.setProperty("--puzzle-y","0px"),c.style.setProperty("z-index","0"),c.style.setProperty("pointer-events","auto"),c.style.setProperty("position","relative"),s==null||s()),i=!1};document.body.addEventListener("touchmove",b),document.body.addEventListener("touchend",w),document.body.addEventListener("mousemove",b),document.body.addEventListener("mouseup",w)};n.addEventListener("touchstart",_),n.addEventListener("mousedown",_)};class $e extends _t{constructor(e,s,o,a,i,_=!1){super(i);L(this,"word");L(this,"baseSrc");L(this,"additionalSrc");L(this,"disabled");L(this,"imageComponent");this.word=e,this.baseSrc=s,this.additionalSrc=o,this.imageComponent=a,this.disabled=_}validate(e){var s,o;return this.removeValidation(),this.word===e?this.node.classList.add((s=J["puzzle_valid-good"])!=null?s:""):this.node.classList.add((o=J["puzzle_valid-bad"])!=null?o:""),this.word===e}removeValidation(){var e,s;this.node.classList.remove((e=J["puzzle_valid-bad"])!=null?e:""),this.node.classList.remove((s=J["puzzle_valid-good"])!=null?s:"")}useBaseSrc(){this.imageComponent.getNode().src=this.baseSrc}useAdditionalSrc(){this.imageComponent.getNode().src=this.additionalSrc}}const Oe=c=>{var d=c,{baseDataImg:n,additionalDataImg:t,onUpdate:e,word:s,fieldRow:o,standbyList:a,classList:i,children:_}=d,l=$(d,["baseDataImg","additionalDataImg","onUpdate","word","fieldRow","standbyList","classList","children"]);const f=r({tag:"span",classList:J.puzzle__text,textContent:s}),g=r({tag:"div",classList:J["puzzle__text-wrapper"],children:[f]}),N=r({tag:"img",classList:y(J.puzzle__img,i),children:_,src:n}),p=new $e(s,n,t,N,A({tag:"div",classList:J.puzzle,children:q(N,g,_),draggable:!1},l)).addEventListener("click",()=>{p.disabled||(o.haveChildren(p)?a.append(p):o.append(p),e==null||e())});return Ae(p,a,o,e),p};function $t(n,t,e){return e.length>n?Math.floor(t-e.slice(n).join("").length/e.join("").length*t):B("Incorrect index")}function ot(n,t,e){return e.length>n?Math.floor(e[n].length/e.join("").length*t):B("Incorrect index")}function Ot(n,t,e,s,o,a=8){const i=o,_=i.getBoundingClientRect(),l=s.split(" "),c=document.createElement("canvas"),d=c.getContext("2d"),f=n!==l.length-1?a:0;if(c.width=ot(n,_.width,l)+f,c.height=_.height/e,d){const g=c.height;d.save(),d.fillStyle="black",d.drawImage(i,$t(n,i.naturalWidth,l),i.naturalHeight/e*t,ot(n,i.naturalWidth,l),i.naturalHeight/e,0,0,ot(n,_.width,l),c.height),n!==0&&(d.globalCompositeOperation="destination-out",d.arc(0,g/2,a-1,0,Math.PI*2,!0),d.fill(),d.globalCompositeOperation="source-over"),n<l.length&&(d.beginPath(),d.arc(ot(n,_.width,l),g/2,a-1,0,2*Math.PI),d.clip(),d.drawImage(i,$t(n,i.naturalWidth,l)+ot(n,i.naturalWidth,l),i.naturalHeight/e*t,ot(n,i.naturalWidth,l)+8,i.naturalHeight/e,ot(n,_.width,l),0,ot(n,_.width,l)+f,c.height),d.closePath(),d.restore())}return{canvas:c,extra:a}}const Re=(n,t,e,s,o)=>{const a=n.words.length,i=[],_=[];return n.words.forEach((l,c)=>{const d=r({tag:"div",classList:y(V.board__row,V.board__row_current)});i.push(d);const f=[];l.textExample.split(" ").forEach((g,N,p)=>{const{canvas:m,extra:u}=Ot(N,c,a,l.textExample,t.getNode()),b=Ot(N,c,a,l.textExample,e.getNode()),w=Oe({baseDataImg:b.canvas.toDataURL("image/png"),additionalDataImg:m.toDataURL("image/png"),word:g,fieldRow:d,standbyList:s,style:{width:`${m.width-(p.length-1!==N?u:0)+.5}px`,height:`${m.height}px`},onUpdate:o});d.getNode().style.height=`${m.height}px`,f.push(w)}),_.push([...f]),d.appendChildren(f)}),{rowList:i,puzzleGrid:_}},Te=n=>{const t=n.slice();return n.forEach((e,s)=>{const o=Math.floor(Math.random()*(s+1));[t[s],t[o]]=[t[o],t[s]]}),t},je="_loader_17ye9_2",Ue="_rotation_17ye9_1",De={loader:je,rotation:Ue},We=e=>{var s=e,{classList:n}=s,t=$(s,["classList"]);return r(A({tag:"div",classList:y(De.loader,n)},t))};class Be extends _t{constructor(){super(...arguments);L(this,"iDontKnow",()=>{});L(this,"isWin",!1);L(this,"rowIsCorrect",!1);L(this,"rowIsComplete",!1);L(this,"validate",()=>{});L(this,"goToNextRow",()=>{})}}const He=d=>{var f=d,{difficulty:n,controlComponent:t,imgSrc:e,level:s,data:o,classList:a,children:i,standbyList:_,onUpdate:l}=f,c=$(f,["difficulty","controlComponent","imgSrc","level","data","classList","children","standbyList","onUpdate"]);o.rounds[s]||B("level not found");const{saveData:g}=Y(),N=We({classList:V.board__loader}),p=o.rounds[s];let m=[],u=[],b=0;const w=r({tag:"img",classList:V.board__img,src:p.levelData.imageSrc,crossOrigin:"anonymous"}),I=r({tag:"p",classList:V.board__text,textContent:`${p.levelData.name}, ${p.levelData.author}, ${p.levelData.year}`}),R=r({tag:"img",classList:y(V.board__img),src:pe,crossOrigin:"anonymous"}),j=r({tag:"div",classList:V["board__puzzle-wrapper"]}),C=new Be(A({tag:"div",classList:y(V.board,V.board_loading,a),children:q(N,w,I,R,j,i),draggable:!1},c)),U=()=>{var h,z,D;((h=g==null?void 0:g.showPuzzle)!=null?h:!1)?((z=u==null?void 0:u[b])!=null?z:[]).forEach(P=>P.useAdditionalSrc()):((D=u==null?void 0:u[b])!=null?D:[]).forEach(P=>P.useBaseSrc())};t.setShowPuzzleHandler(U);const H=v=>{var h,z,D,P,X,F,G;t.setTranslation((z=(h=p.words[v])==null?void 0:h.textExampleTranslate)!=null?z:""),t.setAudioSrc((P=(D=p.words[v])==null?void 0:D.audioExample)!=null?P:""),(F=m[b])==null||F.addClass((X=V.board__row_current)!=null?X:""),m.forEach(tt=>{var et;tt.getNode().classList.remove((et=V.board__row_hidden)!=null?et:"")}),u==null||u.slice(0,v).forEach(tt=>tt.forEach(et=>{et.disabled=!0,et.useAdditionalSrc()})),m.slice(v+1,m.length).forEach(tt=>{V.board__row_hidden&&tt.getNode().classList.add(V.board__row_hidden)}),_.appendChildren(Te((G=u==null?void 0:u[v])!=null?G:[])),U()},W=()=>{var v;if((v=u[b])==null||v.forEach(h=>h.removeValidation()),C.isWin=b===m.length-1,C.isWin){g.levels[n][Number(s)].completed=!0,t.makeVisible(),I.getNode().style.display="block",j.destroy(),w.getNode().style.opacity="1";return}t.makeHidden(),b+=1,H(b)},E=()=>{var G,tt,et,zt,yt;const v=Array.from((tt=(G=m[b])==null?void 0:G.getNode().children)!=null?tt:[]),h=(zt=(et=p.words[b])==null?void 0:et.textExample)!=null?zt:"";(yt=u[b])==null||yt.forEach(lt=>lt.removeValidation());const z=v.map(lt=>lt.textContent),D=()=>{var lt;(lt=u[b])==null||lt.forEach((Dt,Wt)=>{var Ct;Dt.validate((Ct=z[Wt])!=null?Ct:"")})},P=z.join(" ")===h,X=z.length===h.split(" ").length;t.makeHidden(),P&&t.makeVisible(),C.rowIsComplete=X,C.rowIsCorrect=P,C.validate=D,C.goToNextRow=W;const F=z.length;l==null||l({iDontKnow:C.iDontKnow.bind(C),isWin:C.isWin,rowIsCorrect:P,rowIsComplete:X,round:p,rowLength:F,goToNextRow:W,validate:D})};return C.iDontKnow=function(){var v,h;(h=m[b])==null||h.appendChildren((v=u[b])!=null?v:[]),g.levels[n][Number(s)].words[b].hint=!0,W(),E()},C.componentDidMount(()=>{fe([R.getNode(),w.getNode()],()=>{var z;const{rowList:v,puzzleGrid:h}=Re(p,w,R,_,E);u=h,m=v,j.appendChildren(m),N==null||N.destroy(),R.destroy(),H(b),C.removeClass((z=V.board_loading)!=null?z:"")})}),C},ht=new URL("https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/ee4dc7be8759183c549b49bc895e6004fc0f05a2/"),jt={0:"data/wordCollectionLevel1.json",1:"data/wordCollectionLevel2.json",2:"data/wordCollectionLevel3.json",3:"data/wordCollectionLevel4.json",4:"data/wordCollectionLevel5.json",5:"data/wordCollectionLevel6.json"},Me=async n=>{const t=jt[n];if(t){const e=new URL(t,ht);return fetch(e).then(s=>s.json()).then(s=>(s.rounds.forEach(({levelData:o,words:a})=>{o.imageSrc=new URL(`images/${o.imageSrc}`,ht).toString(),o.cutSrc=new URL(`images/${o.cutSrc}`,ht).toString(),a.forEach(i=>{i.audioExample=new URL(i.audioExample,ht).toString()})}),s)).catch(s=>{throw s})}return B("No such difficulty")},Ve="_rotation_1hxyk_1",ft={"play-voice-button":"_play-voice-button_1hxyk_2","play-voice-button_playing":"_play-voice-button_playing_1hxyk_7",rotation:Ve},st=class st extends _t{constructor(e,s){super(s);L(this,"soundSrc");this.soundSrc=e!=null?e:"",this.addEventListener("click",()=>{var a;this.addClass((a=ft["play-voice-button_playing"])!=null?a:"");const o=new Audio(this.soundSrc);st.currentPlaying&&(st.currentPlaying.pause(),st.currentPlaying=null),st.currentPlaying=o,o.onpause=()=>{var i;this.removeClass((i=ft["play-voice-button_playing"])!=null?i:"")},o.play().catch(console.error)})}};L(st,"currentPlaying",null);let bt=st;const Ut=o=>{var a=o,{classList:n,soundSrc:t,children:e}=a,s=$(a,["classList","soundSrc","children"]);return new bt(t!=null?t:"",A({tag:"button",classList:y(ft["play-voice-button"],n),textContent:"🔊"},s))},x={"board-control":"_board-control_bin4u_2","board-control__audio-translate_hidden":"_board-control__audio-translate_hidden_bin4u_8","board-control__translation_hidden":"_board-control__translation_hidden_bin4u_8","board-control__button":"_board-control__button_bin4u_11","board-control__button_active":"_board-control__button_active_bin4u_17","board-control__translation-block":"_board-control__translation-block_bin4u_20","board-control__hide-block":"_board-control__hide-block_bin4u_23"};class Xe extends _t{constructor(e,s,o,a){super(a);L(this,"translation");L(this,"text","");L(this,"audio");L(this,"showPuzzleComponent");this.showPuzzleComponent=o,this.audio=e,this.translation=s}setAudioSrc(e){this.audio.soundSrc=e}makeVisible(){var e,s;this.audio.getNode().classList.remove((e=x["board-control__audio-translate_hidden"])!=null?e:""),this.translation.getNode().classList.remove((s=x["board-control__translation_hidden"])!=null?s:"")}makeHidden(){var a,i,_,l;const{saveData:e}=Y(),s=(a=e==null?void 0:e.audioOn)!=null?a:!0,o=(i=e==null?void 0:e.translateTextOn)!=null?i:!0;s||this.audio.getNode().classList.add((_=x["board-control__audio-translate_hidden"])!=null?_:""),o||this.translation.getNode().classList.add((l=x["board-control__translation_hidden"])!=null?l:"")}setTranslation(e){this.text=e,this.translation.getNode().textContent=this.text}setShowPuzzleHandler(e){const s=()=>{var a;const{saveData:o}=Y();o&&(o.showPuzzle=!((a=o==null?void 0:o.showPuzzle)!=null&&a),e())};this.showPuzzleComponent.addEventListener("click",s)}}const Ye=e=>{var s=e,{classList:n}=s,t=$(s,["classList"]);var p,m;const{saveData:o}=Y();let a=(p=o==null?void 0:o.audioOn)!=null?p:!0,i=(m=o==null?void 0:o.translateTextOn)!=null?m:!0;const _=r({tag:"span",classList:x["board-control__translation"]}).componentDidMount(()=>{var u;i||_.addClass((u=x["board-control__translation_hidden"])!=null?u:"")}),l=Ut({classList:x["board-control__audio-translate"]}).componentDidMount(()=>{var u;a||l.addClass((u=x["board-control__audio-translate_hidden"])!=null?u:"")}),c=r({tag:"button",classList:y(x["board-control__button"],x["board-control__audio-hide"]),textContent:"🔊"}).addEventListener("click",()=>{var u,b,w,I;a=!a,o.audioOn=a,a?(l.removeClass((w=x["board-control__audio-translate_hidden"])!=null?w:""),c.addClass((I=x["board-control__button_active"])!=null?I:"")):(l.addClass((u=x["board-control__audio-translate_hidden"])!=null?u:""),c.removeClass((b=x["board-control__button_active"])!=null?b:""))}).componentDidMount(()=>{var u;a&&c.addClass((u=x["board-control__button_active"])!=null?u:"")}),d=r({tag:"div",classList:x["board-control__translation-block"]}),f=r({tag:"button",classList:y(x["board-control__button"],x["board-control__translation-hide"]),textContent:"🖹"}).addEventListener("click",()=>{var u,b,w,I;i=!i,o.translateTextOn=i,i?(_.removeClass((u=x["board-control__translation_hidden"])!=null?u:""),f.addClass((b=x["board-control__button_active"])!=null?b:"")):(_.addClass((w=x["board-control__translation_hidden"])!=null?w:""),f.removeClass((I=x["board-control__button_active"])!=null?I:""))}).componentDidMount(()=>{var u;i&&f.addClass((u=x["board-control__button_active"])!=null?u:"")}),g=r({tag:"button",textContent:"🖼️",classList:y(x["board-control__button"])}),N=r({tag:"div",classList:x["board-control__hide-block"],children:[c,f,g]});return d.appendChildren([_,l]),new Xe(l,_,g,A({children:[d,N],classList:y(x["board-control"],n)},t))},O={"statistic-modal":"_statistic-modal_llvrf_1","statistic-modal__content":"_statistic-modal__content_llvrf_10","statistic-modal__image":"_statistic-modal__image_llvrf_22","statistic-modal__title":"_statistic-modal__title_llvrf_26","statistic-modal__title_hidden":"_statistic-modal__title_hidden_llvrf_30","statistic-modal__close":"_statistic-modal__close_llvrf_33","statistic-modal__levels":"_statistic-modal__levels_llvrf_45","statistic-modal__levels_hiden":"_statistic-modal__levels_hiden_llvrf_48","statistic-modal__levels_hint":"_statistic-modal__levels_hint_llvrf_51","statistic-modal__button":"_statistic-modal__button_llvrf_54","statistic-modal__button_active":"_statistic-modal__button_active_llvrf_62","statistic-modal__level":"_statistic-modal__level_llvrf_45","statistic-modal__levels-wrapper":"_statistic-modal__levels-wrapper_llvrf_70"},qe=i=>{var _=i,{level:n,difficulty:t,data:e,classList:s,children:o}=_,a=$(_,["level","difficulty","data","classList","children"]);const l=e.rounds[n],{saveData:c}=Y(),{route:d}=rt(),f=r({tag:"div",classList:O["statistic-modal__levels"]}),g=r({tag:"div",classList:y(O["statistic-modal__levels"],O["statistic-modal__levels_hint"])}),N=r({tag:"button",classList:O["statistic-modal__button"],textContent:"Продолжить"}).addEventListener("click",()=>{if(n===e.roundsCount-1&&t===5){d(S.gamePage,{level:0,difficulty:0});return}if(n===e.roundsCount-1){d(S.gamePage,{level:0,difficulty:t+1});return}d(S.gamePage,{level:n+1,difficulty:t})}),p=r({tag:"h4",classList:y(O["statistic-modal__title"],O["statistic-modal__title_hidden"]),textContent:"Ряды собранные c подсказкой:"}),m=r({tag:"h4",classList:y(O["statistic-modal__title"],O["statistic-modal__title_hidden"]),textContent:"Ряды собранные без подсказки:"}),u=r({tag:"div",classList:O["statistic-modal__levels-wrapper"],children:[m,f,p,g]}),b=r({tag:"img",classList:O["statistic-modal__image"],src:l.levelData.cutSrc});l.words.forEach((j,C)=>{var W,E;const U=c==null?void 0:c.levels[t][n].words[C].hint,H=r({tag:"div",classList:O["statistic-modal__level"],children:[Ut({soundSrc:j.audioExample}),r({tag:"span",classList:O["statistic-modal__level"],textContent:j.textExample})]});U?(p.removeClass((W=O["statistic-modal__title_hidden"])!=null?W:""),g.appendChildren(H)):(m.removeClass((E=O["statistic-modal__title_hidden"])!=null?E:""),f.appendChildren(H))});const w=r({tag:"div",classList:O["statistic-modal__content"],children:[b,r({tag:"h4",classList:O["statistic-modal__title"],textContent:`${l.levelData.name}, ${l.levelData.author}, ${l.levelData.year}`}),u,N]}),I=r(A({tag:"div",classList:y(O["statistic-modal"],s),children:[w]},a)),R=r({tag:"button",classList:O["statistic-modal__close"],textContent:"X"}).addEventListener("click",()=>{I.destroy()});return w.append(R),I},Fe="_main_8nkig_2",Ke="_main__content_8nkig_5",k={main:Fe,main__content:Ke,"game-field":"_game-field_8nkig_14","game-field__button":"_game-field__button_8nkig_23","game-field__button_active":"_game-field__button_active_8nkig_31","game-field__button_hidden":"_game-field__button_hidden_8nkig_34","game-field__select":"_game-field__select_8nkig_37","game-field__control":"_game-field__control_8nkig_41","game-field__controls-block":"_game-field__controls-block_8nkig_44","standby-list":"_standby-list_8nkig_53"},Je=s=>{var o=s,{classList:n,children:t}=o,e=$(o,["classList","children"]);var C,U,H,W;const{route:a,args:i,root:_}=rt(),{saveData:l}=Y(),c=(U=(C=i.difficulty)!=null?C:l==null?void 0:l.difficulty)!=null?U:0;let d=(W=(H=i.level)!=null?H:l==null?void 0:l.level)!=null?W:0;l&&(l.level=d,l.difficulty=c);const f=Ye({classList:k["game-field__control"]}),g=r({tag:"div",classList:k["standby-list"]}),N=r({tag:"section",classList:y(k.main__content)}),p=r({tag:"button",classList:y(k["game-field__button"],k["game-field__button_hidden"]),textContent:"Результаты"}),m=r({tag:"button",classList:y(k["game-field__button"],k["game-field__button_hidden"]),textContent:"check row"}),u=r({tag:"select",classList:k["game-field__select"],id:"level"}),b=r({tag:"label",textContent:"Уровень:",children:u}),w=r({tag:"select",classList:k["game-field__select"],id:"difficulty"}),I=r({tag:"label",textContent:"Сложность:",children:w}),R=r({tag:"button",classList:k["game-field__button"],textContent:"Подсказка"}),j=r({tag:"div",classList:y(k["game-field__controls-block"]),children:[I,b,m,p,R]});return Object.keys(jt).forEach(E=>{const v=r({id:`difficulty_${E}`,tag:"option",textContent:(Number(E)+1).toString(),value:E,selected:c===Number(E)});w.append(v)}),w.addEventListener("change",E=>{const v=Number(E.target.value);a(S.gamePage,{level:d,difficulty:v})}),Me(c).then(E=>{E.roundsCount<=d&&(d=0);const v=He({difficulty:c,level:d,data:E,standbyList:g,controlComponent:f,onUpdate:({isWin:h,rowIsCorrect:z,rowIsComplete:D})=>{var P,X,F,G;m.addClass((P=k["game-field__button_hidden"])!=null?P:""),D&&(m.removeClass((X=k["game-field__button_hidden"])!=null?X:""),m.getNode().textContent="Проверить"),z&&(m.removeClass((F=k["game-field__button_hidden"])!=null?F:""),m.getNode().textContent="Продолжить",h&&(m.getNode().textContent="Следуйщий уровень",p.removeClass((G=k["game-field__button_hidden"])!=null?G:"")))}});return Object.keys(E.rounds).forEach(h=>{var P;l&&(l.levels||(l.levels={}),(P=l.levels)!=null&&P[c]||(l.levels[c]={}),l.levels[c][Number(h)]||(l.levels[c][Number(h)]={completed:!1,words:E.rounds[Number(h)].words.map(()=>({hint:!1}))}));const z=l.levels[c][Number(h)].completed?"✅":"",D=r({id:`level_${h}`,tag:"option",textContent:z+(Number(h)+1).toString(),value:h,selected:d===Number(h)});u.append(D)}),u.addEventListener("change",h=>{const z=Number(h.target.value);a(S.gamePage,{level:z,difficulty:c})}),R.addEventListener("click",()=>{var h,z;v.iDontKnow(),v.isWin&&(m.removeClass((h=k["game-field__button_hidden"])!=null?h:""),m.getNode().textContent="Следуйщий уровень",p.removeClass((z=k["game-field__button_hidden"])!=null?z:""))}),p.addEventListener("click",()=>{_.append(qe({level:d,difficulty:c,data:E}))}),m.addEventListener("click",()=>{var h;if(v.isWin){if(d===E.roundsCount-1&&c===5){a(S.gamePage,{level:0,difficulty:0});return}if(d===E.roundsCount-1){a(S.gamePage,{level:0,difficulty:c+1});return}a(S.gamePage,{level:d+1,difficulty:c});return}if(v.rowIsCorrect){v.goToNextRow(),m.addClass((h=k["game-field__button_hidden"])!=null?h:"");return}v.rowIsComplete&&v.validate()}),N.appendChildren([f,v,g,j]),E}).catch(()=>B("Level loading error")),r(A({tag:"main",classList:y(k.main,n),children:q(N,t)},e))},Ge=()=>r({tag:"template",children:[vt({}),Je({}),Lt({})]}),S={startPage:{name:"startPage",path:"/rss-puzzle/",view:ce,needAuth:!1,params:{}},loginPage:{name:"loginPage",path:"/rss-puzzle/login",view:me,needAuth:!1,params:{reg:void 0}},gamePage:{name:"gamePage",path:"/rss-puzzle/game",view:Ge,needAuth:!0,params:{difficulty:void 0,level:void 0}}};function Rt(n){return Object.keys(S).reduce((t,e)=>{var s;return((s=S[e])==null?void 0:s.path)===n?S[e]:t},void 0)}const K=class K{constructor(t,e){L(this,"root");L(this,"defaultRoute");this.root=this.createOrGetRoot(t),this.defaultRoute=e}static create(t,e){return K.instance&&B("Router already created"),Y().isInitialized||B("For a Router work, initiate authProvider first"),K.instance=new K(t,e),K.instance}static getIsInitialized(){return!!K.instance}static initialLoad(){const t=()=>{const e=window.location.href.split("/?/")[1];let s=new URL(window.location.href.toString());e&&(s=new URL(`${window.location.pathname}${e}`,window.location.origin+window.location.pathname));const o=s.pathname,a={};new URLSearchParams(s.search).forEach((i,_)=>{a[_]=i}),K.instance.route(o,a,!1)};window.addEventListener("popstate",()=>{t()}),t()}createOrGetRoot(t){return this.root||(t?this.root=t:(this.root=r({tag:"div",id:"root"}),document.body.append(this.root.getNode()))),this.root}getRoot(){return this.root}route(t,e,s=!0){let o=typeof t=="string"?Rt(t):t;if(!o&&!this.defaultRoute&&B("Route never exist and default route is not set"),!o&&this.defaultRoute&&(o=this.defaultRoute),o){const a=new URL(window.location.href);if(a.searchParams.forEach((i,_)=>a.searchParams.delete(_)),e&&Object.entries(e).forEach(([i,_])=>{_!==null&&a.searchParams.set(i,String(_))}),o.needAuth&&!Y().isAuth){this.route(S.loginPage);return}a.pathname=o.path,s&&window.history.pushState({},"",a),this.root.getChildren().forEach(i=>i.destroy()),this.root.appendChildren(o.view({}).getChildren())}}getRouteInfo(){var o;const t=Rt(window.location.pathname),e=JSON.parse(JSON.stringify(t));e.params={},t||B("Route not found");const s=new URLSearchParams(window.location.search);return Object.keys((o=t.params)!=null?o:{}).forEach(a=>{e.params&&(typeof s.get(a)=="string"?e.params[a]=JSON.parse(s.get(a)):e.params[a]=s.get(a))}),e}static getInstance(){return K.instance}};L(K,"instance");let it=K;const rt=()=>{it.getInstance()||B("Router not created");const n=it.getInstance(),t=n.getRouteInfo();return{root:n.getRoot(),route:n.route.bind(n),args:t.params,isInitialized:it.getIsInitialized()}},Ze=(n,t)=>(it.create(n,t),it.initialLoad(),rt());Vt();Xt();Ze(void 0,S.startPage);
//# sourceMappingURL=index-CV9PR-Bb.js.map
